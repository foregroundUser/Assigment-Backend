<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dern Support - Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --sidebar-width: 280px;
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);

            --primary-color: #667eea;
            --primary-dark: #5a67d8;
            --secondary-color: #f093fb;
            --success-color: #4facfe;
            --warning-color: #43e97b;
            --danger-color: #fa709a;

            --sidebar-bg: #ffffff;
            --sidebar-hover: #f8fafc;
            --sidebar-active: var(--primary-color);
            --sidebar-border: #e2e8f0;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --border-color: #e2e8f0;
            --bg-light: #f7fafc;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Toast Notification System */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 400px;
        }

        .toast-notification {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 12px;
            box-shadow: var(--shadow-xl);
            border-left: 4px solid;
            display: flex;
            align-items: center;
            gap: 16px;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .toast-notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast-notification.success {
            border-left-color: #10b981;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%);
        }

        .toast-notification.error {
            border-left-color: #ef4444;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.05) 100%);
        }

        .toast-notification.warning {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.05) 100%);
        }

        .toast-notification.info {
            border-left-color: #3b82f6;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(37, 99, 235, 0.05) 100%);
        }

        .toast-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
            flex-shrink: 0;
        }

        .toast-notification.success .toast-icon {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .toast-notification.error .toast-icon {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .toast-notification.warning .toast-icon {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .toast-notification.info .toast-icon {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .toast-message {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .toast-close:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--text-primary);
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: var(--sidebar-bg);
            color: var(--text-primary);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--sidebar-border);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            transform: translateX(0);
        }

        body.sidebar-hidden .sidebar {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            border-bottom: 1px solid var(--sidebar-border);
            display: flex;
            align-items: center;
            gap: 1rem;
            min-height: 90px;
            position: relative;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
        }

        .sidebar-logo {
            width: 48px;
            height: 48px;
            background: var(--primary-gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 20px;
            flex-shrink: 0;
            color: white;
            box-shadow: var(--shadow-md);
        }

        .sidebar-title {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            white-space: nowrap;
        }

        .sidebar-title h2 {
            font-size: 18px;
            font-weight: 700;
            margin: 0;
            color: var(--text-primary);
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sidebar-title p {
            font-size: 13px;
            color: var(--text-secondary);
            margin: 0;
            font-weight: 500;
        }

        .sidebar-toggle {
            width: 44px;
            height: 44px;
            background: var(--primary-gradient);
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }

        .sidebar-toggle:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-lg);
        }

        .sidebar-content {
            flex: 1;
            padding: 1.5rem 0;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .sidebar-group {
            margin-bottom: 2.5rem;
        }

        .sidebar-group-label {
            padding: 0 1.5rem;
            font-size: 12px;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
            white-space: nowrap;
            overflow: hidden;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-menu-item {
            position: relative;
            margin: 0 1rem;
        }

        .sidebar-menu-button {
            width: calc(100% - 2rem);
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            margin: 0.25rem 0;
        }

        .sidebar-menu-button:hover {
            background: var(--sidebar-hover);
            color: var(--text-primary);
            transform: translateX(4px);
        }

        .sidebar-menu-button.active {
            background: var(--primary-gradient);
            color: white;
            box-shadow: var(--shadow-md);
            transform: translateX(4px);
        }

        .sidebar-menu-button.active::before {
            content: '';
            position: absolute;
            left: -1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 24px;
            background: white;
            border-radius: 2px;
        }

        .sidebar-menu-button i {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 18px;
        }

        .sidebar-menu-text {
            white-space: nowrap;
            overflow: hidden;
            font-weight: 600;
        }

        /* Profile Section */
        .sidebar-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--sidebar-border);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.03) 0%, rgba(118, 75, 162, 0.03) 100%);
        }

        .profile-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            overflow: hidden;
            position: relative;
            background: white;
            border: 1px solid var(--sidebar-border);
            box-shadow: var(--shadow-sm);
        }

        .profile-section:hover {
            background: var(--sidebar-hover);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .profile-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid transparent;
            background: var(--primary-gradient);
            background-clip: padding-box;
            flex-shrink: 0;
        }

        .profile-info {
            flex: 1;
            overflow: hidden;
        }

        .profile-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .profile-email {
            font-size: 13px;
            color: var(--text-secondary);
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .logout-btn {
            position: absolute;
            top: 50%;
            right: 1rem;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
        }

        .profile-section:hover .logout-btn {
            opacity: 1;
        }

        .logout-btn:hover {
            transform: translateY(-50%) scale(1.1);
            box-shadow: var(--shadow-md);
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        body.sidebar-hidden .main-content {
            margin-left: 0;
        }

        .main-header {
            background: white;
            border-bottom: 1px solid var(--border-color);
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            box-shadow: var(--shadow-sm);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .header-title {
            display: flex;
            flex-direction: column;
        }

        .header-title h1 {
            font-size: 24px;
            font-weight: 700;
            margin: 0;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-title p {
            font-size: 14px;
            color: var(--text-secondary);
            margin: 0;
        }

        .auth-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .auth-status {
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .auth-status.connected {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%);
            color: #059669;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .auth-status.disconnected {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.05) 100%);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .main-body {
            flex: 1;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.02) 0%, rgba(118, 75, 162, 0.02) 100%);
        }

        /* Welcome Banner */
        .welcome-banner {
            background: var(--primary-gradient);
            color: white;
            border-radius: 20px;
            padding: 3rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-xl);
            position: relative;
            overflow: hidden;
        }

        .welcome-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.1;
        }

        .banner-content {
            position: relative;
            z-index: 1;
        }

        .banner-content h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .banner-content p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 2rem;
            max-width: 600px;
            line-height: 1.6;
        }

        .banner-icon {
            width: 140px;
            height: 140px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .quick-action-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .quick-action-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .quick-action-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-color);
        }

        .quick-action-card:hover::before {
            transform: scaleX(1);
        }

        .quick-action-icon {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin: 0 auto 1.5rem auto;
            background: var(--primary-gradient);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .quick-action-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .quick-action-desc {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .stat-card.users::before {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }

        .stat-card.requests::before {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }

        .stat-card.pending::before {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .stat-card.completed::before {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .stat-card.revenue::before {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .stat-content {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .stat-icon {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }

        .stat-icon.users {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(29, 78, 216, 0.05) 100%);
            color: #1d4ed8;
        }

        .stat-icon.requests {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(124, 58, 237, 0.05) 100%);
            color: #7c3aed;
        }

        .stat-icon.pending {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.05) 100%);
            color: #d97706;
        }

        .stat-icon.completed {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%);
            color: #059669;
        }

        .stat-icon.revenue {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.05) 100%);
        }

        .stat-info h3 {
            font-size: 2.2rem;
            font-weight: 800;
            margin: 0;
            color: var(--text-primary);
            line-height: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .stat-info p {
            font-size: 13px;
            color: var(--text-secondary);
            margin: 0.5rem 0 0 0;
            font-weight: 500;
            line-height: 1.3;
        }

        /*
        .stat-trend {
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            margin-top: 0.5rem;
        }

        .stat-trend.up {
            color: #059669;
        }

        .stat-trend.down {
            color: #dc2626;
        }
        */

        /* Content Sections */
        .content-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .content-section:hover {
            box-shadow: var(--shadow-lg);
        }

        .section-header {
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .section-header h2 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .section-header p {
            color: var(--text-secondary);
            margin: 0;
            font-size: 15px;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table th {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .data-table tr:hover {
            background: var(--bg-light);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* Buttons */
        .btn-primary {
            background: var(--primary-gradient);
            border: none;
            color: white;
            padding: 0.875rem 1.75rem;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 14px;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            border: none;
            color: white;
            padding: 0.625rem 1.25rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 13px;
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            color: white;
            padding: 0.625rem 1.25rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
            box-shadow: var(--shadow-sm);
        }

        .btn-success:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border: none;
            color: white;
            padding: 0.625rem 1.25rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
            box-shadow: var(--shadow-sm);
        }

        .btn-danger:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        /* Status Badges */
        .badge-status {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .badge-pending {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.05) 100%);
            color: #d97706;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .badge-progress {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(37, 99, 235, 0.05) 100%);
            color: #2563eb;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .badge-resolved {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%);
            color: #059669;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .badge-confirmed {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, rgba(8, 145, 178, 0.05) 100%);
            color: #0891b2;
            border: 1px solid rgba(6, 182, 212, 0.2);
        }

        .badge-cancelled {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.05) 100%);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .badge-admin {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(124, 58, 237, 0.05) 100%);
            color: #7c3aed;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .badge-user {
            background: linear-gradient(135deg, rgba(107, 114, 128, 0.1) 0%, rgba(75, 85, 99, 0.05) 100%);
            color: #4b5563;
            border: 1px solid rgba(107, 114, 128, 0.2);
        }

        /* Page System */
        .page {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .page-title h2 {
            font-size: 2rem;
            font-weight: 700;
            margin: 0;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-title p {
            color: var(--text-secondary);
            margin: 0.5rem 0 0 0;
            font-size: 15px;
        }

        /* Loading Animation */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 4rem;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid rgba(102, 126, 234, 0.1);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.3;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 600;
        }

        .empty-state p {
            font-size: 15px;
            line-height: 1.6;
        }

        /* Alert */
        .alert {
            padding: 1rem 1.5rem;
            border-radius: 12px;
            margin: 1rem 0;
            border: 1px solid;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .alert-danger {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.05) 100%);
            color: #dc2626;
            border-color: rgba(239, 68, 68, 0.2);
        }

        .alert-info {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(37, 99, 235, 0.05) 100%);
            color: #2563eb;
            border-color: rgba(59, 130, 246, 0.2);
        }

        .alert-warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.05) 100%);
            color: #d97706;
            border-color: rgba(245, 158, 11, 0.2);
        }

        .alert-success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%);
            color: #059669;
            border-color: rgba(16, 185, 129, 0.2);
        }

        .d-none {
            display: none !important;
        }

        /* Search and Filter */
        .search-filter-section {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .search-box {
            position: relative;
            flex: 1;
            min-width: 250px;
        }

        .search-box input {
            width: 100%;
            padding: 0.875rem 1rem 0.875rem 3rem;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .filter-select {
            padding: 0.875rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Feedback Cards */
        .feedback-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .feedback-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .feedback-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .feedback-user {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .feedback-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .feedback-rating {
            display: flex;
            gap: 0.25rem;
        }

        .star {
            color: #fbbf24;
            font-size: 16px;
        }

        .star.empty {
            color: #e5e7eb;
        }

        .feedback-content {
            color: var(--text-primary);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .feedback-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .welcome-banner {
                flex-direction: column;
                text-align: center;
                gap: 2rem;
                padding: 2rem;
            }

            .banner-content h1 {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .quick-actions {
                grid-template-columns: 1fr;
            }

            .page-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .toast-container {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }

            .data-table {
                font-size: 13px;
            }

            .data-table th,
            .data-table td {
                padding: 0.75rem 0.5rem;
            }

            .main-header {
                padding: 1rem;
            }

            .main-body {
                padding: 1rem;
            }

            .search-filter-section {
                flex-direction: column;
            }

            .search-box {
                min-width: auto;
            }

            .stat-info h3 {
                font-size: 1.8rem;
                white-space: nowrap;
            }

            .stat-info p {
                font-size: 12px;
            }

            /* .stat-trend {
                font-size: 10px;
            } */
        }

        @media (max-width: 480px) {
            .banner-content h1 {
                font-size: 1.75rem;
            }

            .banner-content p {
                font-size: 1rem;
            }

            .stat-card {
                padding: 1.5rem;
            }

            .stat-content {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }

            .stat-info h3 {
                font-size: 1.6rem;
                white-space: nowrap;
            }
        }
    </style>
</head>
<body class="">

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <div class="sidebar-logo">D</div>
        <div class="sidebar-title">
            <h2>Dern Support</h2>
            <p>Admin Dashboard</p>
        </div>
    </div>

    <div class="sidebar-content">
        <div class="sidebar-group">
            <div class="sidebar-group-label">Asosiy Bo'lim</div>
            <ul class="sidebar-menu">
                <li class="sidebar-menu-item">
                    <button class="sidebar-menu-button active" data-page="dashboard">
                        <i class="fas fa-chart-line"></i>
                        <span class="sidebar-menu-text">Dashboard</span>
                    </button>
                </li>
                <li class="sidebar-menu-item">
                    <button class="sidebar-menu-button" data-page="users">
                        <i class="fas fa-users"></i>
                        <span class="sidebar-menu-text">Foydalanuvchilar</span>
                    </button>
                </li>
                <li class="sidebar-menu-item">
                    <button class="sidebar-menu-button" data-page="requests">
                        <i class="fas fa-file-text"></i>
                        <span class="sidebar-menu-text">So'rovlar</span>
                    </button>
                </li>
                <li class="sidebar-menu-item">
                    <button class="sidebar-menu-button" data-page="feedback">
                        <i class="fas fa-star"></i>
                        <span class="sidebar-menu-text">Feedback</span>
                    </button>
                </li>
            </ul>
        </div>
    </div>

    <div class="sidebar-footer">
        <div class="profile-section">
            <img src="https://www.mona.uwi.edu/modlang/sites/default/files/modlang/male-avatar-placeholder.png" alt="Profile" class="profile-avatar" id="profileAvatar">
            <div class="profile-info">
                <p class="profile-name" id="profileName">Admin</p>
                <p class="profile-email" id="profileEmail">admin@dernsupport.uz</p>
            </div>
            <button class="logout-btn" onclick="handleLogout()" title="Chiqish">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="main-content">
    <div class="main-header">
        <div class="header-left">
            <button class="sidebar-toggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <div class="header-title">
                <h1>Admin Dashboard</h1>
                <p>Tizimni boshqarish va nazorat paneli</p>
            </div>
        </div>
        <div class="auth-section">
            <div class="auth-status" id="authStatus">
                <i class="fas fa-wifi"></i>
                Ulanmoqda...
            </div>
        </div>
    </div>

    <div class="main-body">
        <!-- Dashboard Page -->
        <div id="page-dashboard" class="page active">
            <div class="page-header">
                <div class="page-title">
                    <h2>Dashboard</h2>
                    <p>Tizim umumiy ko'rinishi va statistikalar</p>
                </div>
            </div>

            <!-- Welcome Banner -->
            <div class="welcome-banner">
                <div class="banner-content">
                    <h1 id="welcomeText">Xush kelibsiz, Admin!</h1>
                    <p>Tizimni boshqarish va nazorat qilish uchun zamonaviy admin paneli. Bu yerda barcha ma'lumotlar, statistikalar va tizim holatini real vaqtda kuzatishingiz mumkin.</p>
                </div>
                <div class="banner-icon">
                    üë®‚Äçüíº
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <div class="quick-action-card" onclick="switchPage('users')">
                    <div class="quick-action-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="quick-action-title">Foydalanuvchilar</div>
                    <div class="quick-action-desc">Barcha foydalanuvchilarni boshqarish va nazorat qilish</div>
                </div>
                <div class="quick-action-card" onclick="switchPage('requests')">
                    <div class="quick-action-icon">
                        <i class="fas fa-file-text"></i>
                    </div>
                    <div class="quick-action-title">So'rovlar</div>
                    <div class="quick-action-desc">Barcha so'rovlarni ko'rish va boshqarish</div>
                </div>
                <div class="quick-action-card" onclick="switchPage('feedback')">
                    <div class="quick-action-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="quick-action-title">Feedback</div>
                    <div class="quick-action-desc">Mijozlar fikr-mulohazalari</div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card users">
                    <div class="stat-content">
                        <div class="stat-icon users">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalUsers">0</h3>
                            <p>Jami foydalanuvchilar</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card requests">
                    <div class="stat-content">
                        <div class="stat-icon requests">
                            <i class="fas fa-file-text"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalRequests">0</h3>
                            <p>Jami so'rovlar</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card pending">
                    <div class="stat-content">
                        <div class="stat-icon pending">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="pendingRequests">0</h3>
                            <p>Kutilayotgan so'rovlar</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card completed">
                    <div class="stat-content">
                        <div class="stat-icon completed">
                            <i class="fas fa-check-double"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="completedRequests">0</h3>
                            <p>Tugallangan so'rovlar</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card revenue">
                    <div class="stat-content">
                        <div class="stat-icon revenue">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalRevenue">$0</h3>
                            <p>Jami daromad</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Requests -->
            <div class="content-section">
                <div class="section-header">
                    <div>
                        <h2>So'nggi so'rovlar</h2>
                        <p>Eng yangi kelgan so'rovlar ro'yxati</p>
                    </div>
                    <button class="btn-primary" onclick="switchPage('requests')">
                        <i class="fas fa-eye"></i>
                        Barchasini ko'rish
                    </button>
                </div>

                <div class="loading-spinner" id="recentRequestsSpinner" style="display: none;">
                    <div class="spinner"></div>
                </div>

                <div id="recentRequestsContainer">
                    <!-- Recent requests will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Users Page -->
        <div id="page-users" class="page">
            <div class="page-header">
                <div class="page-title">
                    <h2>Foydalanuvchilar</h2>
                    <p>Barcha tizim foydalanuvchilarini boshqarish va nazorat qilish</p>
                </div>

            </div>

            <div class="content-section">
                <div class="loading-spinner" id="usersSpinner" style="display: none;">
                    <div class="spinner"></div>
                </div>

                <div id="usersContainer">
                    <!-- Users table will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Requests Page -->
        <div id="page-requests" class="page">
            <div class="page-header">
                <div class="page-title">
                    <h2>So'rovlar</h2>
                    <p>Barcha foydalanuvchi so'rovlarini boshqarish va nazorat qilish</p>
                </div>
            </div>

            <div class="search-filter-section">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="requestSearch" placeholder="So'rov qidirish..." onkeyup="filterRequests()">
                </div>
                <select class="filter-select" id="requestStatusFilter" onchange="filterRequests()">
                    <option value="all">Barcha holatlar</option>
                    <option value="PENDING">Hal Bo`lmagan</option>
                    <option value="WAITING">Kutilmoqda</option>
                    <option value="IN_PROGRESS">Jarayonda</option>
                    <option value="CONFIRMED">Tasdiqlangan</option>
                    <option value="DONE">Tugallangan</option>
                    <option value="CANCELLED">Bekor qilingan</option>
                </select>
                <select class="filter-select" id="requestTypeFilter" onchange="filterRequests()">
                    <option value="all">Barcha turlar</option>
                    <option value="other">Other</option>
                    <option value="hardware">Hardware</option>
                    <option value="software">Software</option>
                    <option value="network">Network</option>
                </select>
            </div>

            <div class="content-section">
                <div class="loading-spinner" id="requestsSpinner" style="display: none;">
                    <div class="spinner"></div>
                </div>

                <div id="requestsContainer">
                    <!-- Requests table will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Feedback Page -->
        <div id="page-feedback" class="page">
            <div class="page-header">
                <div class="page-title">
                    <h2>Feedback</h2>
                    <p>Mijozlar fikr-mulohazalari va baholash</p>
                </div>
            </div>

            <div class="content-section">
                <div class="loading-spinner" id="feedbackSpinner" style="display: none;">
                    <div class="spinner"></div>
                </div>

                <div id="feedbackContainer">
                    <!-- Feedback will be loaded here -->
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Send Mail Modal -->
<div class="modal fade" id="sendMailModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Xabar yuborish</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="sendMailForm">
                <div id="sendMailFeedback" class="alert alert-danger d-none"></div>
                <div class="modal-body">
                    <input type="hidden" id="mailRequestId">
                    <div class="mb-3">
                        <label class="form-label">Xabar matni *</label>
                        <textarea class="form-control" id="mailText" rows="4" required placeholder="Foydalanuvchiga yuborilacak xabar..."></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Narx (agar kerak bo'lsa)</label>
                        <input type="number" class="form-control" id="mailPrice" placeholder="Masalan: 50">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Bekor qilish</button>
                    <button type="submit" class="btn btn-primary">Yuborish</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Logout Confirmation Modal -->
<div class="modal fade" id="logoutModal" tabindex="-1">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Chiqish</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Haqiqatan ham tizimdan chiqmoqchimisiz?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Bekor qilish</button>
                <button type="button" class="btn btn-danger" onclick="confirmLogout()">
                    <i class="fas fa-sign-out-alt"></i>
                    Chiqish
                </button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Global variables
    let currentUsers = [];
    let currentRequests = [];
    let currentFeedbacks = [];
    let currentAdmin = null;
    let API_BASE_URL = 'http://localhost:4000';

    // Toast Notification System
    class ToastManager {
        constructor() {
            this.container = document.getElementById('toastContainer');
            this.toasts = [];
        }

        show(message, type = 'info', title = '', duration = 5000) {
            const toast = this.createToast(message, type, title, duration);
            this.container.appendChild(toast);
            this.toasts.push(toast);

            setTimeout(() => {
                toast.classList.add('show');
            }, 100);

            if (duration > 0) {
                setTimeout(() => {
                    this.remove(toast);
                }, duration);
            }

            return toast;
        }

        createToast(message, type, title, duration) {
            const toast = document.createElement('div');
            toast.className = `toast-notification ${type}`;

            const icons = {
                success: 'fas fa-check',
                error: 'fas fa-times',
                warning: 'fas fa-exclamation',
                info: 'fas fa-info'
            };

            const titles = {
                success: title || 'Muvaffaqiyat!',
                error: title || 'Xatolik!',
                warning: title || 'Ogohlantirish!',
                info: title || 'Ma\'lumot'
            };

            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="${icons[type]}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-title">${titles[type]}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="toastManager.remove(this.parentElement)">
                    <i class="fas fa-times"></i>
                </button>
            `;

            return toast;
        }

        remove(toast) {
            if (toast && toast.parentElement) {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentElement) {
                        toast.parentElement.removeChild(toast);
                    }
                    this.toasts = this.toasts.filter(t => t !== toast);
                }, 300);
            }
        }

        success(message, title = '', duration = 5000) {
            return this.show(message, 'success', title, duration);
        }

        error(message, title = '', duration = 7000) {
            return this.show(message, 'error', title, duration);
        }

        warning(message, title = '', duration = 6000) {
            return this.show(message, 'warning', title, duration);
        }

        info(message, title = '', duration = 5000) {
            return this.show(message, 'info', title, duration);
        }
    }

    // Initialize toast manager
    const toastManager = new ToastManager();

    // Initialize app
    document.addEventListener('DOMContentLoaded', () => {
        initNavigation();
        initModals();
        loadSidebarState();
        initApp();
    });

    function initApp() {
        testConnection();
        fetchAdminProfile();
        loadDashboardData();
    }

    // API helper function
    async function apiRequest(endpoint, options = {}) {
        const token = localStorage.getItem('token');
        const defaultOptions = {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
                ...options.headers
            }
        };

        const response = await fetch(`${API_BASE_URL}${endpoint}`, {
            ...defaultOptions,
            ...options
        });

        return response;
    }

    async function testConnection() {
        const uid = localStorage.getItem('uid');
        const token = localStorage.getItem('token');
        const authStatus = document.getElementById('authStatus');

        if (!uid || !token) {
            authStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Token/UID mavjud emas';
            authStatus.className = 'auth-status disconnected';
            toastManager.error('Token yoki UID mavjud emas', 'Autentifikatsiya xatosi');
            return false;
        }

        try {
            authStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Tekshirilmoqda...';
            authStatus.className = 'auth-status';

            const response = await apiRequest(`/isAdmin?uid=${uid}`);

            if (response.ok) {
                const data = await response.json();
                if (data.isAdmin) {
                    authStatus.innerHTML = '<i class="fas fa-check-circle"></i> Admin ulangan';
                    authStatus.className = 'auth-status connected';
                    toastManager.success('Admin panelga muvaffaqiyatli ulandingiz');
                    return true;
                } else {
                    throw new Error('Admin huquqi yo\'q');
                }
            } else {
                throw new Error('Authentication failed');
            }
        } catch (err) {
            console.error('Connection test failed:', err);
            authStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Ulanmagan';
            authStatus.className = 'auth-status disconnected';
            toastManager.error('Admin huquqi yo\'q yoki serverga ulanishda xatolik');

            // Redirect to login if not admin
            setTimeout(() => {
                window.location.href = '../index.html';
            }, 3000);
            return false;
        }
    }

    // Sidebar toggle
    function toggleSidebar() {
        document.body.classList.toggle('sidebar-hidden');
        localStorage.setItem('sidebarHidden', document.body.classList.contains('sidebar-hidden'));
    }

    function loadSidebarState() {
        const sidebarPreference = localStorage.getItem('sidebarHidden');
        if (sidebarPreference === 'true') {
            document.body.classList.add('sidebar-hidden');
        }
    }

    // Navigation system
    function initNavigation() {
        const navButtons = document.querySelectorAll('.sidebar-menu-button[data-page]');
        const pages = document.querySelectorAll('.page');

        navButtons.forEach(button => {
            button.addEventListener('click', function() {
                const pageId = this.dataset.page;
                switchPage(pageId);
            });
        });

        window.switchPage = function(pageId) {
            navButtons.forEach(btn => btn.classList.remove('active'));
            const targetButton = document.querySelector(`[data-page="${pageId}"]`);
            if (targetButton) {
                targetButton.classList.add('active');
            }

            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(`page-${pageId}`).classList.add('active');

            switch(pageId) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'requests':
                    loadRequests();
                    break;
                case 'feedback':
                    loadFeedbacks();
                    break;
            }
        }
    }

    // Load dashboard data
    async function loadDashboardData() {
        try {
            const [usersRes, requestsRes] = await Promise.all([
                apiRequest('/admin/users'),
                apiRequest('/admin/requests')
            ]);

            if (usersRes.ok && requestsRes.ok) {
                const users = await usersRes.json();
                const requests = await requestsRes.json();

                currentUsers = users;
                currentRequests = requests;

                updateDashboardStats(users, requests);
                loadRecentRequests(requests.slice(0, 10));
            }
        } catch (err) {
            console.error('Error loading dashboard data:', err);
            toastManager.error('Dashboard ma\'lumotlarini yuklashda xatolik');
        }
    }

    function updateDashboardStats(users, requests) {
        const totalUsers = users.length;
        const totalRequests = requests.length;
        const pendingRequests = requests.filter(r => r.status === 'PENDING' || r.status === 'WAITING').length;
        const completedRequests = requests.filter(r => r.status === 'DONE').length;
        const totalRevenue = requests
            .filter(r => r.status === 'DONE' && r.price)
            .reduce((sum, r) => sum + (parseFloat(r.price) || 0), 0);

        document.getElementById('totalUsers').textContent = totalUsers;
        document.getElementById('totalRequests').textContent = totalRequests;
        document.getElementById('pendingRequests').textContent = pendingRequests;
        document.getElementById('completedRequests').textContent = completedRequests;
        document.getElementById('totalRevenue').textContent = `$${Math.round(totalRevenue)}`;
    }

    function loadRecentRequests(requests) {
        const container = document.getElementById('recentRequestsContainer');

        if (!requests || requests.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-file-text"></i>
                    <h3>Hozircha so'rovlar yo'q</h3>
                    <p>Yangi so'rovlar kelganda bu yerda ko'rsatiladi</p>
                </div>
            `;
            return;
        }

        const tableHTML = `
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Foydalanuvchi</th>
                        <th>Muammo</th>
                        <th>Turi</th>
                        <th>Status</th>
                        <th>Narx</th>
                        <th>Sana</th>
                        <th>Amallar</th>
                    </tr>
                </thead>
                <tbody>
                    ${requests.map(req => {
            let actionButtons = '';

            // Message button: faqat WAITING holatdagi OTHER turdagi requestlar uchun
            if (req.status === 'WAITING' && req.problemType === 'other') {
                actionButtons += `
                                <button class="btn-icon btn-secondary" onclick="openSendMailModal('${req.id}')" title="Xabar yuborish">
                                    <i class="fas fa-envelope"></i>
                                </button>
                            `;
            }

            // Progress button: WAITING (other bo'lmagan) va CONFIRMED (other) uchun
            if ((req.status === 'WAITING' && req.problemType !== 'other') ||
                (req.status === 'CONFIRMED' && req.problemType === 'other')) {
                actionButtons += `
                                <button class="btn-icon btn-success" onclick="updateRequestStatus('${req.id}', 'IN_PROGRESS')" title="Jarayonga o'tkazish">
                                    <i class="fas fa-play"></i>
                                </button>
                            `;
            }

            // Done button: faqat IN_PROGRESS holatdagi requestlar uchun
            if (req.status === 'IN_PROGRESS') {
                actionButtons += `
                                <button class="btn-icon btn-success" onclick="updateRequestStatus('${req.id}', 'DONE')" title="Tugallash">
                                    <i class="fas fa-check"></i>
                                </button>
                            `;
            }

            return `
                            <tr>
                                <td>#${req.id.slice(-6)}</td>
                                <td>${req.uid || 'Noma\'lum'}</td>
                                <td>${req.issueName || 'Noma\'lum'}</td>
                                <td>${req.problemType || '‚Äî'}</td>
                                <td>${getStatusBadge(req.status)}</td>
                                <td>${req.price ? `$${req.price}` : '‚Äî'}</td>
                                <td>${formatDate(req.createdAt)}</td>
                                <td>${actionButtons || '‚Äî'}</td>
                            </tr>
                        `;
        }).join('')}
                </tbody>
            </table>
        `;

        container.innerHTML = tableHTML;
    }

    // Load users
    async function loadUsers() {
        const spinner = document.getElementById('usersSpinner');
        const container = document.getElementById('usersContainer');

        if (spinner) spinner.style.display = 'flex';

        try {
            const response = await apiRequest('/admin/users');

            if (!response.ok) throw new Error('Failed to load users');

            const users = await response.json();
            currentUsers = users;

            if (!users || users.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>Hozircha foydalanuvchilar yo'q</h3>
                        <p>Yangi foydalanuvchi qo'shish uchun yuqoridagi tugmani bosing</p>
                    </div>
                `;
                return;
            }

            displayUsers(users);

        } catch (err) {
            console.error('Error loading users:', err);
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Foydalanuvchilarni yuklashda xatolik</h3>
                    <p>Iltimos, qaytadan urinib ko'ring</p>
                </div>
            `;
            toastManager.error('Foydalanuvchilarni yuklashda xatolik yuz berdi');
        } finally {
            if (spinner) spinner.style.display = 'none';
        }
    }

    function displayUsers(users) {
        const container = document.getElementById('usersContainer');

        const tableHTML = `
            <table class="data-table">
                <thead>
                    <tr>
                        <th>UID</th>
                        <th>Foydalanuvchi</th>
                        <th>Email</th>
                        <th>Rol</th>
                        <th>Ro'yxatdan o'tgan</th>
                        <th>Amallar</th>
                    </tr>
                </thead>
                <tbody>
                    ${users.map(user => `
                        <tr>
                            <td>#${(user.uid || '').slice(-6)}</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--primary-gradient); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 16px;">
                                        ${(user.username || 'U').charAt(0).toUpperCase()}
                                    </div>
                                    <div>
                                        <div style="font-weight: 600; color: var(--text-primary);">${user.username || 'Noma\'lum'}</div>
                                        <div style="font-size: 13px; color: var(--text-secondary);">#${(user.uid || '').slice(-6)}</div>
                                    </div>
                                </div>
                            </td>
                            <td>${user.email || 'Noma\'lum'}</td>
                            <td>${user.isAdmin ? '<span class="badge-admin"><i class="fas fa-shield-alt"></i> Admin</span>' : '<span class="badge-user"><i class="fas fa-user"></i> Foydalanuvchi</span>'}</td>
                            <td>${formatDate(user.createdAt)}</td>
                            <td>
                                <button class="btn-icon btn-danger" onclick="deleteUser('${user.uid}')" title="O'chirish">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;

        container.innerHTML = tableHTML;
    }

    // Load requests
    async function loadRequests() {
        const spinner = document.getElementById('requestsSpinner');
        const container = document.getElementById('requestsContainer');

        if (spinner) spinner.style.display = 'flex';

        try {
            const response = await apiRequest('/admin/requests');

            if (!response.ok) throw new Error('Failed to load requests');

            const requests = await response.json();
            currentRequests = requests;

            if (!requests || requests.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-file-text"></i>
                        <h3>Hozircha so'rovlar yo'q</h3>
                        <p>Foydalanuvchilar so'rov yuborgan vaqtda bu yerda ko'rsatiladi</p>
                    </div>
                `;
                return;
            }

            displayRequests(requests);

        } catch (err) {
            console.error('Error loading requests:', err);
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>So'rovlarni yuklashda xatolik</h3>
                    <p>Iltimos, qaytadan urinib ko'ring</p>
                </div>
            `;
            toastManager.error('So\'rovlarni yuklashda xatolik yuz berdi');
        } finally {
            if (spinner) spinner.style.display = 'none';
        }
    }

    function displayRequests(requests) {
        const container = document.getElementById('requestsContainer');

        const tableHTML = `
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Foydalanuvchi</th>
                        <th>Muammo</th>
                        <th>Tavsif</th>
                        <th>Turi</th>
                        <th>Status</th>
                        <th>Narx</th>
                        <th>Joylashuv</th>
                        <th>Sana</th>
                        <th>Amallar</th>
                    </tr>
                </thead>
                <tbody>
                    ${requests.map(req => {
            let actionButtons = '';

            // Message button: faqat WAITING holatdagi OTHER turdagi requestlar uchun
            if (req.status === 'WAITING' && req.problemType === 'other') {
                actionButtons += `
                                <button class="btn-icon btn-secondary" onclick="openSendMailModal('${req.id}')" title="Xabar yuborish">
                                    <i class="fas fa-envelope"></i>
                                </button>
                            `;
            }

            // Progress button: faqat WAITING (other bo'lmagan) va CONFIRMED (other) uchun
            if ((req.status === 'WAITING' && req.problemType !== 'other') ||
                (req.status === 'CONFIRMED' && req.problemType === 'other')) {
                actionButtons += `
                                <button class="btn-icon btn-success" onclick="updateRequestStatus('${req.id}', 'IN_PROGRESS')" title="Jarayonga o'tkazish">
                                    <i class="fas fa-play"></i>
                                </button>
                            `;
            }

            // Done button: faqat IN_PROGRESS holatdagi requestlar uchun
            if (req.status === 'IN_PROGRESS') {
                actionButtons += `
                                <button class="btn-icon btn-success" onclick="updateRequestStatus('${req.id}', 'DONE')" title="Tugallash">
                                    <i class="fas fa-check"></i>
                                </button>
                            `;
            }

            // Cancel button: barcha aktiv requestlar uchun (DONE va CANCELLED dan tashqari)
            if (req.status !== 'DONE' && req.status !== 'CANCELLED') {
                actionButtons += `
                                <button class="btn-icon btn-danger" onclick="updateRequestStatus('${req.id}', 'CANCELLED')" title="Bekor qilish">
                                    <i class="fas fa-times"></i>
                                </button>
                            `;
            }

            return `
                            <tr>
                                <td>#${req.id.slice(-6)}</td>
                                <td>${req.uid || 'Noma\'lum'}</td>
                                <td>${req.issueName || 'Noma\'lum'}</td>
                                <td title="${req.description || ''}">${(req.description || '').substring(0, 50)}${(req.description || '').length > 50 ? '...' : ''}</td>
                                <td>${req.problemType || '‚Äî'}</td>
                                <td>${getStatusBadge(req.status)}</td>
                                <td>${req.price ? `$${req.price}` : '‚Äî'}</td>
                                <td>${req.location || '‚Äî'}</td>
                                <td>${formatDate(req.createdAt)}</td>
                                <td>${actionButtons || '‚Äî'}</td>
                            </tr>
                        `;
        }).join('')}
                </tbody>
            </table>
        `;

        container.innerHTML = tableHTML;
    }

    function filterRequests() {
        const searchTerm = document.getElementById('requestSearch').value.toLowerCase();
        const statusFilter = document.getElementById('requestStatusFilter').value;
        const typeFilter = document.getElementById('requestTypeFilter').value;

        const filteredRequests = currentRequests.filter(request => {
            const matchesSearch = (request.issueName || '').toLowerCase().includes(searchTerm) ||
                (request.uid || '').toLowerCase().includes(searchTerm) ||
                request.id.toLowerCase().includes(searchTerm);

            const matchesStatus = statusFilter === 'all' || request.status === statusFilter;
            const matchesType = typeFilter === 'all' || request.problemType === typeFilter;

            return matchesSearch && matchesStatus && matchesType;
        });

        displayRequests(filteredRequests);
    }

    // Load feedbacks
    async function loadFeedbacks() {
        const spinner = document.getElementById('feedbackSpinner');
        const container = document.getElementById('feedbackContainer');

        if (spinner) spinner.style.display = 'flex';

        try {
            const [feedbacksRes, statsRes] = await Promise.all([
                apiRequest('/admin/feedbacks'),
                apiRequest('/admin/feedbacksStats')
            ]);

            if (!feedbacksRes.ok || !statsRes.ok) throw new Error('Failed to load feedbacks');

            const feedbacksData = await feedbacksRes.json();
            const statsData = await statsRes.json();

            const feedbacks = feedbacksData.feedbacks || [];
            const stats = statsData.stats || [];

            currentFeedbacks = feedbacks;

            if (!feedbacks || feedbacks.length === 0) {
                container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-star"></i>
                    <h3>Hozircha feedback yo'q</h3>
                    <p>Mijozlar feedback qoldirgan vaqtda bu yerda ko'rsatiladi</p>
                </div>
            `;
                return;
            }

            displayFeedbacks(feedbacks, stats);

        } catch (err) {
            console.error('Error loading feedbacks:', err);
            container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Feedbacklarni yuklashda xatolik</h3>
                <p>Iltimos, qaytadan urinib ko'ring</p>
            </div>
        `;
            toastManager.error('Feedbacklarni yuklashda xatolik yuz berdi');
        } finally {
            if (spinner) spinner.style.display = 'none';
        }
    }

    function displayFeedbacks(feedbacks, stats) {
        const container = document.getElementById('feedbackContainer');

        // Simple statistics
        const totalFeedbacks = feedbacks.length;
        const overallAverage = feedbacks.reduce((sum, f) => sum + f.rating, 0) / totalFeedbacks;
        const positiveCount = feedbacks.filter(f => f.rating >= 4).length;

        // Simple stats section
        const statsHTML = `
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
            <div class="stat-card">
                <div class="stat-content">
                    <div class="stat-icon" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(29, 78, 216, 0.05) 100%); color: #1d4ed8;">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div class="stat-info">
                        <h3>${totalFeedbacks}</h3>
                        <p>Jami feedbacklar</p>
                    </div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-content">
                    <div class="stat-icon" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.05) 100%); color: #d97706;">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="stat-info">
                        <h3>${overallAverage.toFixed(1)}</h3>
                        <p>O'rtacha reyting</p>
                    </div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-content">
                    <div class="stat-icon" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%); color: #059669;">
                        <i class="fas fa-thumbs-up"></i>
                    </div>
                    <div class="stat-info">
                        <h3>${positiveCount}</h3>
                        <p>Ijobiy feedbacklar</p>
                    </div>
                </div>
            </div>
        </div>
    `;

        // Simple feedback list
        const feedbacksHTML = `
        <div class="content-section">
            <h3 style="margin-bottom: 1.5rem; color: var(--text-primary);">Barcha feedbacklar</h3>
            <div style="display: grid; gap: 1rem;">
                ${feedbacks.map(feedback => `
                    <div class="feedback-card">
                        <div class="feedback-header">
                            <div class="feedback-user">
                                <div class="feedback-avatar">
                                    ${(feedback.uid || 'U').slice(-1).toUpperCase()}
                                </div>
                                <div>
                                    <div style="font-weight: 600;">Foydalanuvchi</div>
                                    <div style="font-size: 13px; color: var(--text-secondary);">#${(feedback.uid || '').slice(-6)}</div>
                                </div>
                            </div>
                            <div class="feedback-rating">
                                ${Array.from({length: 5}, (_, i) =>
            `<i class="fas fa-star ${i < feedback.rating ? 'star' : 'star empty'}"></i>`
        ).join('')}
                            </div>
                        </div>
                        <div class="feedback-content">
                            ${feedback.comment || 'Izoh qoldirilmagan'}
                        </div>
                        <div class="feedback-meta">
                            <span>So'rov ID: #${(feedback.requestId || '').slice(-6)}</span>
                            <span>${formatDate(feedback.createdAt)}</span>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;

        container.innerHTML = statsHTML + feedbacksHTML;
    }

    // Fetch admin profile
    async function fetchAdminProfile() {
        const uid = localStorage.getItem('uid');

        if (!uid) return;

        try {
            const response = await apiRequest(`/user/profile/${uid}`);

            if (!response.ok) throw new Error("Admin ma'lumotlarini olishda xatolik");

            const admin = await response.json();
            currentAdmin = admin;

            const profileImg = document.getElementById('profileAvatar');
            const profileName = document.getElementById('profileName');
            const profileEmail = document.getElementById('profileEmail');

            if (profileImg && admin.profileImage) {
                profileImg.src = admin.profileImage;
            }

            if (profileName && admin.username) {
                profileName.textContent = admin.username;
            }

            if (profileEmail && admin.email) {
                profileEmail.textContent = admin.email;
            }

        } catch (err) {
            console.error("Admin ma'lumotlari topilmadi:", err);
        }
    }

    function initModals() {
        initSendMailModal();
    }

    function initSendMailModal() {
        const form = document.getElementById('sendMailForm');
        const feedback = document.getElementById('sendMailFeedback');

        function showError(msg) {
            feedback.textContent = msg;
            feedback.classList.remove('d-none');
        }

        function clearError() {
            feedback.textContent = '';
            feedback.classList.add('d-none');
        }

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            clearError();

            const requestId = document.getElementById('mailRequestId').value;
            const adminMessage = document.getElementById('mailText').value.trim();
            const price = document.getElementById('mailPrice').value;

            if (!adminMessage) {
                return showError('Xabar matnini kiriting.');
            }

            try {
                const body = {
                    adminMessage: adminMessage
                };

                if (price) {
                    body.price = parseFloat(price);
                }

                const response = await apiRequest(`/admin/notify-other/${requestId}`, {
                    method: 'POST',
                    body: JSON.stringify(body)
                });

                if (response.ok) {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('sendMailModal'));
                    modal.hide();
                    form.reset();
                    toastManager.success('Xabar muvaffaqiyatli yuborildi!');
                    loadRequests();
                    loadDashboardData();
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Xabar yuborishda xatolik');
                }
            } catch (err) {
                console.error('Error sending mail:', err);
                showError(err.message || 'Xabar yuborishda xatolik yuz berdi.');
                toastManager.error('Xabar yuborishda xatolik yuz berdi');
            }
        });
    }


    function openSendMailModal(requestId) {
        document.getElementById('mailRequestId').value = requestId;
        const modal = new bootstrap.Modal(document.getElementById('sendMailModal'));
        modal.show();
    }

    function handleLogout() {
        const modal = new bootstrap.Modal(document.getElementById('logoutModal'));
        modal.show();
    }

    function confirmLogout() {
        try {
            localStorage.removeItem('token');
            localStorage.removeItem('uid');
            localStorage.removeItem('sidebarHidden');

            currentAdmin = null;
            currentUsers = [];
            currentRequests = [];
            currentFeedbacks = [];

            toastManager.success('Tizimdan muvaffaqiyatli chiqdingiz');

            const modal = bootstrap.Modal.getInstance(document.getElementById('logoutModal'));
            modal.hide();

            setTimeout(() => {
                window.location.href = '../index.html';
            }, 1500);

        } catch (err) {
            console.error('Logout error:', err);
            toastManager.error('Chiqishda xatolik yuz berdi');
        }
    }

    // Action functions
    async function updateRequestStatus(requestId, newStatus) {
        try {
            const response = await apiRequest(`/admin/request/${requestId}`, {
                method: 'PATCH',
                body: JSON.stringify({ status: newStatus })
            });

            if (response.ok) {
                toastManager.success(`So'rov holati ${newStatus} ga o'zgartirildi!`);
                loadRequests();
                loadDashboardData();
            } else {
                throw new Error('Failed to update status');
            }
        } catch (err) {
            console.error('Error updating request status:', err);
            toastManager.error('So\'rov holatini o\'zgartirishda xatolik yuz berdi');
        }
    }

    async function deleteUser(uid) {
        if (!confirm('Haqiqatan ham bu foydalanuvchini o\'chirmoqchimisiz?')) return;

        try {
            const response = await apiRequest(`/admin/user?uid=${uid}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                toastManager.success('Foydalanuvchi muvaffaqiyatli o\'chirildi!');
                loadUsers();
                loadDashboardData();
            } else {
                throw new Error('Failed to delete user');
            }
        } catch (err) {
            console.error('Error deleting user:', err);
            toastManager.error('Foydalanuvchini o\'chirishda xatolik yuz berdi');
        }
    }

    // Utility functions
    function getStatusBadge(status) {
        switch (status) {
            case 'WAITING':
                return '<span class="badge-pending">Kutilmoqda</span>';
            case 'PENDING':
                return '<span class="badge-pending">Pending</span>';
            case 'IN_PROGRESS':
                return '<span class="badge-progress">Jarayonda</span>';
            case 'CONFIRMED':
                return '<span class="badge-confirmed">Tasdiqlangan</span>';
            case 'CANCELLED':
                return '<span class="badge-cancelled">Bekor qilingan</span>';
            case 'DONE':
                return '<span class="badge-resolved">Tugallangan</span>';
            default:
                return `<span class="badge-pending">${status}</span>`;
        }
    }

    function formatDate(dateString) {
        if (!dateString) return '‚Äî';
        try {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return '‚Äî';
            return date.toLocaleDateString('uz-UZ', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        } catch (err) {
            return '‚Äî';
        }
    }

    // Mobile responsiveness
    function handleResize() {
        const sidebar = document.getElementById('sidebar');
        if (window.innerWidth <= 768) {
            sidebar.classList.add('hidden');
        }
    }

    window.addEventListener('resize', handleResize);
    handleResize();
</script>

</body>
</html>